{"version":3,"file":"index.es.js","sources":["../src/utils.ts","../src/Avatar.tsx"],"sourcesContent":["import { useCallback, useEffect, useRef } from 'react';\n\nconst useIsMounted = () => {\n  const isMounted = useRef(false);\n\n  useEffect(() => {\n    isMounted.current = true;\n    return () => {\n      isMounted.current = false;\n    };\n  }, []);\n\n  return useCallback(() => isMounted.current, []);\n};\n\nexport { useIsMounted };\n","import type { IconProps } from '@launchpad-ui/icons';\nimport type { ComponentType, HTMLAttributes } from 'react';\n\nimport { Person } from '@launchpad-ui/icons';\nimport { cx } from 'classix';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport styles from './styles/Avatar.module.css';\nimport { useIsMounted } from './utils';\n\ntype AvatarProps = HTMLAttributes<HTMLDivElement> & {\n  alt?: string;\n  url: string;\n  size?: 'tiny' | 'small' | 'medium' | 'large';\n  initials?: string;\n  defaultIcon?: ComponentType<IconProps>;\n  'data-test-id'?: string;\n};\n\nconst DIMENSIONS = {\n  tiny: '10',\n  small: '16',\n  medium: '24',\n  large: '40',\n};\n\nconst Avatar = ({\n  alt = '',\n  url,\n  defaultIcon: DefaultIcon = Person,\n  className,\n  initials,\n  size = 'medium',\n  'data-test-id': testId = 'avatar',\n  ...rest\n}: AvatarProps) => {\n  const isMounted = useIsMounted();\n  const [useDefaultAvatar, setUseDefaultAvatar] = useState(!url);\n  const [imageSource, setImageSource] = useState<string | null>(null);\n  const classes = cx(styles.Avatar, styles[`Avatar--${size}`], className);\n\n  const processImageSource = useCallback(async (res: Response) => {\n    if (res.status === 404 || res.headers.get('Content-type')?.includes('image/svg')) {\n      setImageSource(null);\n    } else {\n      const img = await res.blob();\n      setImageSource(URL.createObjectURL(img));\n    }\n  }, []);\n\n  useEffect(() => {\n    if (url) {\n      fetch(url)\n        .then((res) => {\n          if (isMounted()) {\n            processImageSource(res);\n          }\n        })\n        .catch();\n    } else {\n      setImageSource('');\n    }\n  }, [url, processImageSource, isMounted]);\n\n  if (useDefaultAvatar || !imageSource) {\n    if (initials) {\n      const color = (initials.charCodeAt(0) + initials.charCodeAt(1)) % 5;\n\n      const initialsContainerClasses = cx(\n        classes,\n        styles['Avatar--initials'],\n        styles[`Avatar--color${color as 0 | 1 | 2 | 3 | 4}`]\n      );\n\n      return (\n        <div className={initialsContainerClasses} data-test-id={testId} {...rest}>\n          <span className={styles['Avatar-initials-content']}>{initials}</span>\n        </div>\n      );\n    } else {\n      return <DefaultIcon className={classes} data-test-id={testId} size={size} {...rest} />;\n    }\n  }\n\n  const dimension = DIMENSIONS[size];\n\n  return (\n    <img\n      {...rest}\n      alt={alt}\n      className={classes}\n      src={imageSource}\n      width={dimension}\n      height={dimension}\n      data-test-id={testId}\n      onError={() => setUseDefaultAvatar(true)}\n    />\n  );\n};\n\nexport { Avatar };\nexport type { AvatarProps };\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAEA,MAAM,eAAe,MAAM;AACnB,QAAA,YAAY,OAAO,KAAK;AAE9B,YAAU,MAAM;AACd,cAAU,UAAU;AACpB,WAAO,MAAM;AACX,gBAAU,UAAU;AAAA,IAAA;AAAA,EAExB,GAAG,CAAE,CAAA;AAEL,SAAO,YAAY,MAAM,UAAU,SAAS,CAAE,CAAA;AAChD;ACMA,MAAM,aAAa;AAAA,EACjB,MAAM;AAAA,EACN,OAAO;AAAA,EACP,QAAQ;AAAA,EACR,OAAO;AACT;AAEA,MAAM,SAAS,CAAC;AAAA,EACd,MAAM;AAAA,EACN;AAAA,EACA,aAAa,cAAc;AAAA,EAC3B;AAAA,EACA;AAAA,EACA,OAAO;AAAA,EACP,gBAAgB,SAAS;AAAA,KACtB;AACL,MAAmB;AACjB,QAAM,YAAY;AAClB,QAAM,CAAC,kBAAkB,mBAAmB,IAAI,SAAS,CAAC,GAAG;AAC7D,QAAM,CAAC,aAAa,cAAc,IAAI,SAAwB,IAAI;AAClE,QAAM,UAAU,GAAG,OAAO,QAAQ,OAAO,WAAW,SAAS,SAAS;AAEhE,QAAA,qBAAqB,YAAY,OAAO,QAAkB;;AAC1D,QAAA,IAAI,WAAW,SAAO,SAAI,QAAQ,IAAI,cAAc,MAA9B,mBAAiC,SAAS,eAAc;AAChF,qBAAe,IAAI;AAAA,IAAA,OACd;AACC,YAAA,MAAM,MAAM,IAAI;AACP,qBAAA,IAAI,gBAAgB,GAAG,CAAC;AAAA,IACzC;AAAA,EACF,GAAG,CAAE,CAAA;AAEL,YAAU,MAAM;AACd,QAAI,KAAK;AACP,YAAM,GAAG,EACN,KAAK,CAAC,QAAQ;AACb,YAAI,aAAa;AACf,6BAAmB,GAAG;AAAA,QACxB;AAAA,MAAA,CACD,EACA,MAAM;AAAA,IAAA,OACJ;AACL,qBAAe,EAAE;AAAA,IACnB;AAAA,EACC,GAAA,CAAC,KAAK,oBAAoB,SAAS,CAAC;AAEnC,MAAA,oBAAoB,CAAC,aAAa;AACpC,QAAI,UAAU;AACN,YAAA,SAAS,SAAS,WAAW,CAAC,IAAI,SAAS,WAAW,CAAC,KAAK;AAElE,YAAM,2BAA2B;AAAA,QAC/B;AAAA,QACA,OAAO;AAAA,QACP,OAAO,gBAAgB;AAAA,MAAA;AAGzB,aACG,oBAAA,OAAA,EAAI,WAAW,0BAA0B,gBAAc,QAAS,GAAG,MAClE,UAAA,oBAAC,QAAK,EAAA,WAAW,OAAO,4BAA6B,oBAAS,EAChE,CAAA;AAAA,IAAA,OAEG;AACE,aAAA,oBAAC,eAAY,WAAW,SAAS,gBAAc,QAAQ,MAAa,GAAG,KAAM,CAAA;AAAA,IACtF;AAAA,EACF;AAEA,QAAM,YAAY,WAAW;AAG3B,SAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACE,GAAG;AAAA,MACJ;AAAA,MACA,WAAW;AAAA,MACX,KAAK;AAAA,MACL,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,gBAAc;AAAA,MACd,SAAS,MAAM,oBAAoB,IAAI;AAAA,IAAA;AAAA,EAAA;AAG7C;"}